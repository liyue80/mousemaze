/*
 *
 */
#include <stdio.h>
#include <string.h>
#include "StandardSpace.h"
#include "ParallelSpace.h"
#include "FastDeque.h"
#include "Performance.h"

/* **************************************
* Main function and global variables.
************************************** */
#define WIDTH  30
#define HEIGHT 30

/* 已知的3个测试用例 */
#define C1 "111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111111111111111101111111111111111"
#define C2 "111110000000000000000000000011110010111111111110111111110100110010100000010000100000010010110011111100010000100111110010110010100101111110100000010010110110100101111110111111111110111010100101111110100000010010110010100101111110101111110010110010100101111110100000010010110110100101111110111111010110111010100101111110100000010010110010110111111111100000010010110010101001010100101111110110110010100101010101100000010010010010100001010110111111110110010010111101010100111111110010011110100000010101111111110110000000100000000110111111110010111011111111110100111111110010101011100000000100111111110010101011100000000101100000001110101011111111110110100000000010101011100000001100101111111110111000101001000100100000000000001000101001000000111111111111011111111111111110010000010001010100101010010010001010100111010100101010010011111111100100010100101110010100101010111111110111100011110000000000000001"
#define C3 "111110000100010010101001000011110010111111111110111111110100110010100000010000100000010011110011111100010000101111110010110010100101111110100000010010110110100101111110111111111111111010100101111110100000010010110010100101111110101111110010110010100101111110100000010010110110100101111110111111010111111010100101111110100000010010110010110111111111100000010010110010101001010100101111110111110010100101010101100000010010010010100001010110111111110111010010111101010100111111110010011110100000010101111111110111000000100000010110111111110010111011111111110100111111110010101011100000010100111111110010101011100000010101100000001111101011111111110110100000000010101011100000001100101111111111111000101001110100101000000000001000001001000000111111111111011111111111111110010000010001010100101010010010001010100111010100101010010011111111100100010100101110010100101010111111110111100011110000000000101101"

#if defined(PERFORMANCE_TEST)
GPerformance pfMem = {0};
GPerformance pfTotal = {0};
#endif

int main(int argc, char **argv)
{
    char inputs[WIDTH * HEIGHT + 100];
	GFastDeque dequeForSpaces;
	GParallelSpace Space;
	GStandardSpace StandardSpace;
    GParallelSpace GoalSpace1;
    GParallelSpace GoalSpace2;
    bool goal1 = false;
    bool goal2 = false;

#if defined(PERFORMANCE_TEST)
    strcpy(inputs, C2);
    pfTotal.summary = 0;
    strcpy(pfTotal.name, "total");
    strcpy(pfMem.name, "memory");
#else
    gets(inputs);
#endif

    GPerformance_Resume(&pfTotal);

	GStandardSpace_Initialize(&StandardSpace);
    GParallelSpace_Initialize(&Space, &StandardSpace);
    GParallelSpace_InitializeTable(&Space, inputs);
    GParallelSpace_InitializeEntry(&Space, 29, 29);

	GFastDeque_Initialize(&dequeForSpaces);
    GFastDeque_PushBack(&dequeForSpaces, &Space);

    // reuse pSpace in the while loop
    while (!goal1 || !goal2)
    {
        Direction dir;

        if (!GFastDeque_PopFront(&dequeForSpaces, &Space))
        {
            break;
        }

		for ( dir = LEFT; dir <= DOWN; dir++ )
        {
            GParallelSpace NextSpace;
            if (!GParallelSpace_Move(&Space, dir, &NextSpace))
                continue;

            if ((!goal1) && GParallelSpace_TestGoal(&NextSpace, 0, 0))
            {
                mem_cpy(&GoalSpace1, &NextSpace, sizeof(GParallelSpace));
				goal1 = true;
            }

            if ((!goal2) && GParallelSpace_TestGoal(&NextSpace, 0, 29))
            {
                mem_cpy(&GoalSpace2, &NextSpace, sizeof(GParallelSpace));
				goal2 = true;
            }

			//printf("(%d,%d)->(%d,%d) ", pSpace->currentPos.x, pSpace->currentPos.y, pParallel->currentPos.x, pParallel->currentPos.y);
            GFastDeque_PushBack(&dequeForSpaces, &NextSpace);
        }
    }

#ifndef PERFORMANCE_TEST
    if (goal1)
		printf("%s", GParallelSpace_Output(&GoalSpace1));
	else
		printf("0");

    if (goal2)
		printf("%s", GParallelSpace_Output(&GoalSpace2));
	else
		printf("0");
#endif

	GPerformance_Pause(&pfTotal);
    GPerformance_Output(&pfTotal);
    GPerformance_Output(&pfMem);
	return 0;
}

